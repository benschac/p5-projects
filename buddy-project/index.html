<!DOCTYPE html>
<html lang="en">
    <head>
        <title></title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
         <script src="//cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.7/p5.js"></script>

        <script>
            let font;
            let vehicles = [];
            let msg = ["Chris", "is", "my", "Buddy!"];
            let maxPoints; 

            let count = 0;

           function preload() {
            font = loadFont('RobotoMono-Bold.ttf');
            }

            function setup() {
                createCanvas(600, 300);
                background(51);
                // textFont(font);
                textSize(128);
                // fill(255);


                maxPoints = max(msg.map((text) => { return font.textToPoints(text, 0, 0).length }))

                let points = font.textToPoints("Chris!", 30, 200);

                stroke(0,255,0)
                strokeWeight(4)
                points.forEach((p) => {
                    let vehicle = new Vehicle(p.x, p.y);
                    vehicles.push(vehicle);
                })
            };

            function mouseClicked() {

                function counter() {
                    count += 1;
                    return count;
                }   

                let index = counter();

                let m = msg[index];
                let newPoints = font.textToPoints(m, 30, 200);
                vehicles.forEach((v, i) => {
                    let np = newPoints[i]
                    v.target = createVector(np.x, np.y)
                }
                )

            }

            function draw() {

                background(51);
                vehicles.forEach((v) => {
                    v.behaviors();
                    v.update();
                    v.show();
                })
            };

                function Vehicle(x, y) {
                    this.pos = createVector(random(width), random(height));
                    this.target = createVector(x, y);
                    this.vel = p5.Vector.random2D();
                    this.acc = createVector();

                    this.maxspeed = 2;
                    this.maxforce = 0.5;
                    this.fleeforce = .5;
                }

                Vehicle.prototype.update = function() {
                    this.pos.add(this.vel);
                    this.vel.add(this.acc);
                    this.acc.mult(0);
                }

                Vehicle.prototype.show = function() {
                    stroke(255),
                    strokeWeight(5);
                    point(this.pos.x, this.pos.y);
                }

                Vehicle.prototype.behaviors = function(){
                    let seek = this.seek(this.target);
                    this.applyForce(seek);

                    var mouse = createVector(mouseX, mouseY);
                    var flee = this.flee(mouse);
                    this.applyForce(flee);
                }

                Vehicle.prototype.applyForce = function(f){
                    this.acc.add(f);
                }

                Vehicle.prototype.seek = function(target){
                    let desired = p5.Vector.sub(target, this.pos);
                    let d = desired.mag();
                    let speed = this.maxspeed;
                    if (d < 100){
                        speed = map(d, 0, 100, 0, this.maxspeed)
                    }
                    desired.setMag(speed);
                    let steer = p5.Vector.sub(desired, this.vel);
                    steer.limit(this.maxforce)
                    return steer;
                }

                Vehicle.prototype.flee = function(target){
                    let desired = p5.Vector.sub(target, this.pos);
                    let d = desired.mag();
                    if (d < 50){
                       desired.setMag(this.maxspeed);
                        desired.mult(-1);
                        let steer = p5.Vector.sub(desired, this.vel);
                        steer.limit(this.fleeforce);
                        return steer;
                    } else { return createVector(0, 0)}
                }
            
        </script>
    </head>
    <body>
         
    </body>
</html>